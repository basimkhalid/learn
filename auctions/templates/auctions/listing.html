{% extends "auctions/layout.html" %}

{% block body %}
<div class="headcontainer bidcontainer">
    <h3><strong>Title:</strong>  {{ listing.title }}</h3>
    posted by: {{ listing.author }}
</div>
<div class="detailcontainer">
    <div class="bidcontainer">
        <div class="topbar">
            <div>
                <h3>Bids</h3>
            </div>
            {% if  listing.author == request.user %}
            <div>
                <a class="btn btn-warning" href="{% url 'auctions:closebid' listing.id %}"><strong>Close Bid</strong></a>
            </div>
            {% endif %}
        </div>
        
        <p><strong>Initial Price: USD {{ listing.initialprice }}</strong></p>
        {% ifnotequal maxbid None %}
            <p> Highest Bidder: {{ maxbid.biduser }}</p>
            <p> <strong>Highest Bid Amount: USD {{ maxbid.bidamount }}</strong></p>
        {% else %}
            <p> There are no bids on this Listing</p>
        {% endifnotequal %}

        {% if user.is_authenticated %}

            {% if listing.bidinprogress %}
                {% if  listing.author != request.user %}
                    <div >
                        {% if bid_msg is not None %}
                            <p>{{ bid_msg }}</p>
                        {% endif %}
                        <form class="bidform" action="{% url 'auctions:newbid' listing.id %}" method="post">
                            {% csrf_token %}
                            <input class="form-control" type="number" min="1" step="any" name="newbidamount" placeholder="New Bid amount">
                            <input class="btn btn-primary" type="Submit" value="Add Bid">
                        </form>
                    </div>
                {% endif %}
            {% else %}
                <p><strong>This bid is won by: {{ maxbid.biduser }}</strong></p>
            {% endif %}
        {% endif %}

        <div class="commentsbox">
            {% if not comments %}
                <p> There are no comments on this Listing</p>
            {% else %}
                <h4>Comments</h4>
                {% for c in comments %}
                    <p>{{ c.commentdate }} : {{ c.commentuser }} says: <i>{{ c.comment }}</i></p>
                {% endfor %}
            {% endif %}
        </div>
        
    </div>
    <div class="listcontainer">
        <div class="listingdesc">
            <h4>Description</h4>
            <p>{{ listing.description }}</p>
        </div>
        <div class="listimage">
            <img src="{{ listing.imageurl }}" alt="Image not available">
        </div>
    </div>
    
</div>
{% endblock %}